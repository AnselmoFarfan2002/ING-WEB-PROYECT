<!DOCTYPE html>
<html>
<head>
	<title></title>
	<%- include('./parts/html.head.complements.ejs')%>
	<link rel="stylesheet" href="css/footer.css">
</head>
<style>
	body{
		display: grid;
		min-height: 100vh;
		grid-template-rows: auto 1fr auto;
	}
</style>
<body>
	<%if(session){%>
		<%- include('./parts/nav.dashboard.ejs') %>
	<%}else if(!session){%>
		<%- include('./parts/nav.ejs') %>
	<%}%>
	<div id="contenido" class="d-flex justify-content-center">
		<div id="sub_contenido">
			<div class="caja_centrada py-3 pb-4">
				<p class="text-start fw-bold fs-1">Publicaciones</p>
			</div>

			<table class="table table-striped table-hover table-bordered align-middle" id="publicaciones" style="margin:auto;">
			<thead>
				<tr>
				<th scope="col">AUTOR</th>
				<th scope="col">FECHA</th>
				<th scope="col">TITULO</th>
				<th scope="col">PRECIO</th>
				<th scope="col">FOTOS</th>
				<th scope="col">ACCION</th>
				</tr>
			</thead class="table-group-divider">
			<tbody>

			</tbody>
			</table>
		</div>
	</div>
	<%- include('./parts/footer.ejs') %>
</body>

<script type="text/javascript">
	fetch('/publicaciones')
	.then( res => res.json() )
	.then( publicaciones => {
		publicaciones.forEach( publicacion => {
			publicacion.fotos = JSON.parse(publicacion.fotos);

			let fotos = "";
			publicacion.fotos.forEach( foto => {
				fotos += `<img class="m-1" style="width: 50px; height: 50px;" src="/images/posts-photos/${foto}">`;
			} );

			fila = `
				<tr >
			      <th scope="row">${publicacion.autor}</th>
			      <td>${publicacion.fecha}</td>
			      <td>${publicacion.titulo}</td>
			      <td>${publicacion.precio}</td>
			      <td>${fotos}</td>
			      <td><a type="button" href="/publicacion?id=${publicacion.id}" class="btn btn-outline-dark">Ver detalles</a></td>
			    </tr>
		    `;

		    document.querySelector('#publicaciones tbody').innerHTML += fila;
		}); 
		
	});

	fetch('/categorias').then( resHTTP => resHTTP.json() ).then( resJSON => { console.log(resJSON); } );
</script>

</html>