<!DOCTYPE html>
<html>
<head>
	<title></title>
	<!-- CSS only -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
</head>
<body>
	<%- include('base.ejs') %>

	<table class="table" id="publicaciones">
	  <thead>
	    <tr>
	      <th scope="col">AUTOR</th>
	      <th scope="col">FECHA</th>
	      <th scope="col">TITULO</th>
	      <th scope="col">PRECIO</th>
	      <th scope="col">FOTOS</th>
	      <th scope="col">ACCION</th>
	    </tr>
	  </thead>
	  <tbody>

	  </tbody>
	</table>
</body>

<script type="text/javascript">
	fetch('/publicaciones')
	.then( res => res.json() )
	.then( publicaciones => {
		publicaciones = Object.entries(publicaciones);
		console.log(publicaciones)

		publicaciones.forEach( publicacion => {
			publicacion = publicacion[1];
			publicacion.PUBLI_FOTOS = JSON.parse(publicacion.PUBLI_FOTOS);


			let fotos = "";
			publicacion.PUBLI_FOTOS.forEach( foto => {
				fotos += `<img class="m-1" style="width: 50px; height: 50px;" src="/images/posts-photos/${foto}">`;
			} );

			fila = `
				<tr>
			      <th scope="row">${publicacion.PUBLI_AUTOR}</th>
			      <td>${publicacion.PUBLI_FECHA}</td>
			      <td>${publicacion.PUBLI_TITULO}</td>
			      <td>${publicacion.PUBLI_PRECIO}</td>
			      <td>${fotos}</td>
			      <td><a type="button" href="/publicacion?id=${publicacion.PUBLI_ID}" class="btn btn-info">Ver detalles</a></td>
			    </tr>
		    `;

		    document.querySelector('#publicaciones tbody').innerHTML += fila;
		}); 
		
	})
</script>
</html>