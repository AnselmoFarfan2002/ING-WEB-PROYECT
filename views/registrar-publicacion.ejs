<!DOCTYPE html>
<html lang="es">
<head>
    <title>Registrar publicación</title>
    <meta charset="UTF‐8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="bootstrap/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="css/publicacion_registro.css"> 
</head>

<body>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <%- include('./parts/nav.ejs') %>

        <div id="contenido" class="d-flex justify-content-left">
            <form id="sub_contenido" enctype="multipart/form-data" method="POST" action="publicaciones">

                <!-- Título para entender que es el registro para crear publicación -->
                <div class="caja_centrada py-3 pb-4">
                    <p class="text-start fw-bold fs-1">Crear publicación</p>
                    <p class="text-start text-secondary fw-bold fs-6" >Rellene todos los espacios de este formulario ...</p>
                </div>


                <!-- Todos los registros que se necesitará para las publicaciones -->
                <div class="mb-3 row">
                    <label class="col-sm-4 col-form-label">Nombre de publicación: </label>
                    <div class="col-sm-8">
                        <input type="text" class="form-control" name="titulo" placeholder="ejemplo de ejemplos por ejemplos" required>
                    </div>
                </div>

                <div class="mb-3 row">
                    <label class="col-sm-4 col-form-label">Precio (por kilo): </label>
                    <div class="col-sm-8">
                        <input type="text" class="form-control" name="precio" placeholder="10.00" required>
                    </div>
                </div>
                
                <div class="mb-3 row">
                    <label class="col-sm-4 col-form-label">Descripción :</label>
                    <div class="col-sm-8">
                        <textarea class="form-control" name="descripcion" rows="3" required></textarea>
                    </div>
                </div>

                <div class="mb-3 row">
                    <label class="col-sm-4 col-form-label">Categoría :</label>
                    <div class="col-sm-8">
                        <select class="form-select" id="pre_categoria" size="5" aria-label="size 3 select example">
                            <option value="1" selected>Carnes y huevos</option>
                            <option value="2">Pescados y mariscos</option>
                            <option value="3">Vegetales y hortalizas</option>
                            <option value="4">Frutas</option>
                            <option value="5">Lácteos y derivados</option>
                            <option value="6">Legumbres, tubérculos	y frutos secos</option>
                            <option value="7">Cereales y derivados</option>
                        </select>
                    </div>
                </div>

                <div class="mb-3 row">
                    <label class="col-sm-4 col-form-label">Subcategoría :</label>
                    <div class="col-sm-8">
                        <select class="form-select" name="categoria" size="4" aria-label="size 3 select example">
                            <option value="2">Carnes rojas</option>
                            <option value="3">Carnes blancas</option>
                            <option value="4">Huevos</option>
                            <option value="5">Embutidos</option>
                        </select>

                        <select class="form-select" name="categoria" size="2" aria-label="size 3 select example" style="display:none">
                            <option value="7">Pescados</option>
                            <option value="8">Mariscos</option>
                        </select>

                        <select class="form-select" name="categoria" size="2" aria-label="size 3 select example" style="display:none">
                            <option value="10">Vegetales</option>
                            <option value="11">Hortalizas</option>
                        </select>

                        <select class="form-select" name="categoria" size="2" aria-label="size 3 select example" style="display:none">
                            <option value="14">Dulces y semidulces</option>
                            <option value="15">Ácidas y semiácidas</option>
                        </select>
                        
                        <select class="form-select" name="categoria" size="4" aria-label="size 3 select example" style="display:none">
                            <option value="17">Leche</option>
                            <option value="18">Yogures</option>
                            <option value="19">Quesos</option>
                            <option value="20">Otros</option>
                        </select>
                        
                        <select class="form-select" name="categoria" size="3" aria-label="size 3 select example" style="display:none">
                            <option value="22">Legumbres</option>
                            <option value="23">tubérculos</option>
                            <option value="24">Frutos Secos</option>
                        </select>
                        
                        <select class="form-select" name="categoria" size="2" aria-label="size 3 select example" style="display:none">
                            <option value="26">Cereales</option>
                            <option value="27">Derivados</option>
                        </select>
                    </div>
                </div>

                <div class="mb-3 row">
                    <label class="col-sm-4 col-form-label">Tipo :</label>
                    <div class="col-sm-8">
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="tipo" value="1">
                                <label class="form-check-label" for="inlineRadio1">Orden de compra</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="tipo" value="2">
                                <label class="form-check-label" for="inlineRadio2">Orden de venta</label>
                            </div>
                    </div>
                </div>
 

                <div class="mb-3 row">
                    <label class="col-sm-4 col-form-label">Negociabilidad: </label>
                    <div class="col-sm-8">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" role="switch" name="negociable" checked>
                            <label class="form-check-label"></label>
                        </div>
                    </div>
                </div>

                <div class="mb-3 row">
                    <label class="col-sm-4 col-form-label">Foto de publicación: </label>
                    <div class="col-sm-8">
                        <div class="mb-3">
                            <input class="form-control" type="file" name="photos" multiple>
                        </div>
                    </div>
                </div>

                <input type="number" name="tiempo" value="30" style="display:none">

                <div class="caja_centrada d-flex justify-content-left">
                    <button id="publicar" type="submit" class="btn btn-danger" style="padding-left:40px; padding-right: 40px;">Publicar</button>
                </div>
            </form>
        </div>
    </body>
</html>

<script type="text/javascript">
    //document.getElementById('publicar').addEventListener('click',RegisterPub);
  
    function RegisterPub(){
        let p = document.getElementById('photos');
        let photos = [];

        for(let i=0;i<p.files.length;i++){
            photos.push(p.files[i].name) 
        }

        const data = {
            titulo: document.getElementById('titulo').value,
            descripcion: document.getElementById('descripcion').value,
            precio: document.getElementById('precio').value,
            categoria: document.getElementById('categoria').value,
            tipo: document.getElementById('tipo').value,
            tiempo: '30',
            negociable: document.getElementById('negociable').value,
            fotos: photos
        }

        console.log(data)

        fetch('/publicaciones', {
            method: 'POST',
            body: JSON.stringify(data),
            headers: {
                'Content-Type': 'application/json',
            }
        }).then(res=>res.json())
        .then(data=>console.log(data))
    }
  </script>
  